<div class="row" ng-controller="tableCtrl">
    <!-- #list -->
    <div class="col-sm-3">
        <div class="list-group">
            <div class="list-group-item">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="按名称查询库表" ng-model="tbl">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-primary" ng-click="addForm()"><i class="fa fa-plus"></i></button>
                    </span>
                </div>
            </div>
            <a href="#" class="list-group-item" ng-repeat="table in tables|orderBy:'code'|filter:tbl" ng-class="{active: current.table===table}" ng-click="activeTable(table)" ng-bind="table.code"></a>
        </div>
    </div>
    <!-- #list -->

    <!-- #detail -->
    <div class="col-sm-9" ng-include="tableUrl"></div>
    <!-- #detail -->
</div>

<script type="text/javascript">
    'use strict';
    function tableCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function() {
                $scope.findTables();
            },

            // 查询所有库表
            findTables: function() {
                $http({
                    method: 'get',
                    url: '${app}/table/tables/' + $scope.current.project.id + '?_request_type=json'
                }).success(function(data) {
                    $scope.tables = data;
                    if ($scope.tables.length === 0) {
                        $scope.addForm();
                    } else {
                        $scope.activeTable($scope.tables[0]);
                    }
                });
            },

            // 激活库表
            activeTable: function(table) {
                $scope.tableUrl = '${app}/table/detail?' + $scope.timestamp();
                $scope.current.table = table;
            },

            // 添加库表表单
            addForm: function() {
                $scope.tableUrl = '${app}/table/add';
            }
        }).init();
    }
</script>