<div ng-controller="addBatchCtrl">
    <div class="panel panel-default">
        <div class="panel-heading">添加项目</div>
        <div class="panel-body">
            <form name="projectForm" action="#" method="post" class="form-horizontal" ng-submit="loadTableList($event)">
                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> HOST</label>
                    <div class="col-sm-3">
                        <input name="host" type="text" class="form-control"  ng-model="projectFormData.host" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> PORT</label>
                    <div class="col-sm-3">
                        <input name="port" type="text" class="form-control"  ng-model="projectFormData.port" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> DataBaseName</label>
                    <div class="col-sm-3">
                        <input name="dataBaseName" type="text" class="form-control"  ng-model="projectFormData.dataBaseName" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> UserName</label>
                    <div class="col-sm-3">
                        <input name="userName" type="text" class="form-control"  ng-model="projectFormData.userName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> PassWord</label>
                    <div class="col-sm-5">
                        <input name="password" type="password" class="form-control"  ng-model="projectFormData.password" required>
                        <button class="btn btn-success" ng-disabled="disableGetTablesBtn()"  ng-show="empty(tableList)">
                            <span ng-show="status('loadTableListBtn', ['standbyGet'])" ng-cloak><i class="fa fa-plus"></i> 加载表集合</span>
                            <span ng-show="status('loadTableListBtn', ['getProcessing'])" ng-cloak><i class="fa fa-spinner fa-spin"></i> 正在努力奔跑中...</span>
                        </button>
                    </div>
                </div>

                <!--<div class="form-group">-->
                    <!--<label class="col-sm-2 control-label"><span class="text-danger">*</span> TableName</label>-->
                    <!--<div class="col-sm-3">-->
                        <!--<input name="tableName" type="text" class="form-control" value="_NULL_" ng-model="projectFormData.tableName" required>-->
                    <!--</div>-->
                <!--</div>-->

                <!--<input name="tableName" type="hidden"   ng-bind="tableForm.tableName" >-->
                <!--<input name="code" type="hidden"  ng-bind="tableForm.code" >-->

                <!--<div class="form-group">-->
                    <!--<label class="col-sm-2 control-label"><span class="text-danger">*</span> 库表代码</label>-->
                    <!--<div class="col-sm-3">-->
                        <!--<input name="code" type="text" class="form-control"  ng-model="projectFormData.code"  required>-->
                    <!--</div>-->
                <!--</div>-->


                <div class="form-group" ng-show="!empty(tableList)">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> 库表名称集合</label>
                    <div class="col-sm-6">
                        <div ng-repeat="table in tableList">
                            <input  type="radio"   name="selectTableName"  ng-bind="projectFormData.tableName"  ng-value="{{table.name}}"  ng-click="checkTableName(table.name)">
                            <label > {{table.name}}</label>
                            <br>
                        </div>
                    </div>
                </div>

            </form>
            <form name="tableForm" action="#" method="post" class="form-horizontal" ng-submit="addDataBase($event)" ng-show="!empty(tableList)">
                <div class="form-group">
                    <label class="col-sm-2 control-label">备注</label>
                    <div class="col-sm-6">
                        <textarea name="remark" rows="3" class="form-control" ng-model="projectFormData.remark"></textarea>
                    </div>
                </div>

                <div class="form-group margin-bottom-zero">
                    <div class="col-sm-offset-2 col-sm-3">
                        <button class="btn btn-success" ng-disabled="disableAddProjectBtn()">
                            <span ng-show="status('addBtn', ['standby'])" ng-cloak><i class="fa fa-plus"></i> 添加</span>
                            <span ng-show="status('addBtn', ['processing'])" ng-cloak><i class="fa fa-spinner fa-spin"></i> 正在努力奔跑中...</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
    'use strict';
    function addBatchCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function() {
                $scope.initForm();
            },

            // 初始化表单
            initForm: function() {
                $scope.projectFormData = {projectId: $scope.current.project.id, code: $scope.current.project.props['table_prefix'], _request_type: 'json'};
                $scope.status('addBtn', 'standby');
                $scope.status('loadTableListBtn', 'standbyGet');
            },


            disableAddBtn: function() {
                if ($scope.projectFormData.$invalid) return true;
                if ($scope.status('addBtn', ['processing'])) return true;
                return false;
            },
            disableAddProjectBtn: function() {
                if ($scope.projectFormData.$invalid) return true;
                if ($scope.status('addBtn', ['processing'])) return true;
                return false;
            },

            disableGetTablesBtn: function() {
                if ($scope.projectFormData.$invalid) return true;
                if ($scope.status('loadTableListBtn', ['getProcessing'])) return true;
                return false;
            },

            checkTableName:function (val) {
                $scope.projectFormData.tableName=val;
                $scope.projectFormData.code=val;
            },



            // 查询项目导航
            loadTableList: function($event) {
                $scope.stop($event);
                $scope.status('loadTableListBtn', 'getProcessing');
                $http({
                    method: 'post',
                    url: '${app}/table/getTableList/?_request_type=json',
                    data: jQuery.param($scope.projectFormData)
                }).success(function(data) {
                    $scope.tableList = data;
                    $scope.status('loadTableListBtn', 'standby');
                    $scope.status('addBtn', 'standby');
                });
            },




            // 添加数据
            addDataBase: function($event) {
                console.log($scope.projectFormData.tableName);
                $scope.stop($event);
                $scope.status('addBtn', 'processing');
//                $scope.projectFormData.tableName=$scope.tableForm.tableName;
                $scope.projectFormData.code=$scope.projectFormData.tableName;
                $http({
                    method: 'post',
//                    url: '${app}/project/projects/add',
                    url: '${app}/table/add',
                    data: jQuery.param($scope.projectFormData)
                }).success(function(data) {
                    $scope.tableList = null;
                    $scope.initForm();
                });
            }
        }).init();
    }
</script>