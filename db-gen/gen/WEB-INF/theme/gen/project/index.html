<!-- #tag layout_block('bodyContent') -->
<div ng-controller="projectCtrl">
    <!-- #header -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="#" class="navbar-brand" ng-bind="current.project.name"></a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li ng-repeat="module in modules" ng-class="{active: current.module===module}"><a href="#" ng-bind="module.name" ng-click="active(module)"></a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span>配置</span>
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li ng-show="empty(modules)"><a class="text-danger">未绑定模块</a></li>
                            <li ng-repeat="module in modules"><a href="#" ng-bind="module.name" ng-click="activeConfig(module)"></a></li>
                            <li class="divider"></li>
                            <li><a href="#" ng-click="activeConfig({'configPath': '${app}/project/config'})">项目</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="${app}/index"><i class="fa fa-list"></i> 项目列表</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- #header -->

    <!-- #body -->
    <div class="container" ng-include="moduleUrl"></div>
    <!-- #body -->
</div>

<script type="text/javascript">
    'use strict';
    function projectCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function() {
                $scope.current = {};
                $scope.loadProject();
            },

            // 查询项目导航
            loadProject: function() {
                $http({
                    method: 'get',
                    url: '${app}/project/projects/${id}?_request_type=json'
                }).success(function(data) {
                    $scope.current.project = data;
                    $scope.modules = $scope.current.project.modules.concat();
                    $scope.active($scope.modules[0]);
                });
            },

            // 激活导航
            active: function(module) {
                $scope.moduleUrl = module.path + '?' + $scope.timestamp();
                $scope.current.module = module;
            },

            // 激活配置导航
            activeConfig: function(module) {
                $scope.moduleUrl = module.configPath + '?' + $scope.timestamp();
                $scope.deleteProps($scope.current, 'module');
            }
        }).init();
    }
</script>
<!-- #end -->
<!-- #include('../layout.html') -->
