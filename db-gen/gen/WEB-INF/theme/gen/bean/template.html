<div class="margin-top" ng-controller="beanTplCtrl">
    <form id="templateForm" name="templateForm" method="post" action="#" class="form-horizontal" ng-submit="save($event)">
        <div class="form-group">
            <textarea name="value" rows="35" class="form-control">${tpl}</textarea>
            <input type="hidden" name="beanId" value="{{current.bean.id}}">
            <input type="hidden" name="_request_type" value="json">
        </div>
        <div class="form-group">
            <button class="btn btn-success" ng-disabled="disabledSaveBtn()">
                <span ng-show="status('saveBtn', ['standby'])"><i class="fa fa-floppy-o"></i> 保存</span>
                <span ng-show="status('saveBtn', ['processing'])"><i class="fa fa-spinner fa-spin"></i> 生命不止...折腾不休...</span>
            </button>
        </div>
    </form>
</div>

<script type="text/javascript">
    'use strict';
    function beanTplCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function() {
                $scope.status('saveBtn', 'standby');
            },

            // 保存模板
            save: function($event) {
                $scope.stop($event);
                $scope.status('saveBtn', 'processing');
                $http({
                    method: 'post',
                    url: '${app}/bean/save_template',
                    data: angular.element('#templateForm').serialize()
                }).success(function(data) {
                    $scope.status('saveBtn', 'standby');
                    console.log(data);
                })
            },

            // 判断保存按钮是否有效
            disabledSaveBtn: function() {
                if ($scope.templateForm.$invalid) return true;
                if ($scope.status('saveBtn', ['processing'])) return true;
                return false;
            }
        }).init();
    }
</script>