<div ng-controller="beanTemplateCtrl">
    <div class="panel panel-default">
        <div class="panel-heading">默认模板</div>
        <div class="panel-body">
            <form id="beanTemplateForm" name="beanTemplateForm" method="post" action="#" ng-submit="save($event)">
                <div class="form-group">
                    <textarea name="value" rows="30" class="form-control nowrap">${tpl}</textarea>
                    <input type="hidden" name="projectId" value="{{current.project.id}}">
                    <input type="hidden" name="code" value="${code}">
                    <input type="hidden" name="_request_type" value="json">
                </div>
                <div class="form-group margin-bottom-zero">
                    <button class="btn btn-success" ng-disabled="disableSaveBtn()">
                        <span ng-show="status('saveBtn', ['standby'])"><i class="fa fa-floppy-o"></i> 保存</span>
                        <span ng-show="status('saveBtn', ['processing'])"><i class="fa fa-spinner fa-spin"></i> 正在保存数据...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
    'use strict';
    function beanTemplateCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function() {
                $scope.status('saveBtn', 'standby');
            },

            // 保存模版
            save: function($event) {
                $scope.stop($event);
                $scope.status('saveBtn', 'processing');
                $http({
                    method: 'post',
                    url: '${app}/project/config/save_template_prop',
                    data: angular.element('#beanTemplateForm').serialize()
                }).success(function(data) {
                    console.log(data);
                    $scope.status('saveBtn', 'standby');
                });
            },

            // 判断保存按钮是否有效
            disableSaveBtn: function() {
                if ($scope.beanTemplateForm.$invalid) return true;
                if ($scope.status('saveBtn', ['processing'])) return true;
                return false;
            }
        }).init();
    }
</script>