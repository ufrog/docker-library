<div ng-controller="beanCtrl">
    <div class="panel panel-default">
        <div class="panel-heading">添加简单类型</div>
        <div class="panel-body">
            <form name="beanForm" method="post" action="#" class="form-horizontal" ng-submit="form.create($event)">
                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> 名称</label>
                    <div class="col-sm-3">
                        <input type="text" name="name" class="form-control" ng-model="beanFormData.name" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"><span class="text-danger">*</span> 代码</label>
                    <div class="col-sm-3">
                        <input type="text" name="code" class="form-control" ng-model="beanFormData.code" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">包名</label>
                    <div class="col-sm-5">
                        <input type="text" name="packageName" class="form-control" ng-model="beanFormData.packageName">
                    </div>
                </div>
                <div class="form-group margin-bottom-zero">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button class="btn btn-success" ng-disabled="disabledSaveBtn()">
                            <span ng-show="status('saveBtn', ['standby'])"><i class="fa fa-floppy-o"></i> 保存</span>
                            <span ng-show="status('saveBtn', ['processing'])"><i class="fa fa-spinner fa-spin"></i> 正在保存数据...</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/javascript">
    'use strict';
    function beanCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function () {
                $scope.form.init();
            },

            // 表单方法集合
            form: {
                // 初始化
                init: function() {
                    $scope.status('saveBtn', 'standby');
                    $scope.beanFormData = {projectId: $scope.current.project.id, _request_type: 'json'};
                },

                // 创建
                create: function($event) {
                    $scope.stop($event);
                    $scope.status('saveBtn', 'processing');
                    $http({
                        method: 'post',
                        url: '${app}/bean/add',
                        data: jQuery.param($scope.beanFormData)
                    }).success(function(data) {
                        $scope.status('saveBtn', 'standby');
                        $scope.beans.push(data);
                    });
                }
            },

            // 判断保存按钮是否可用
            disabledSaveBtn: function() {
                if ($scope.beanForm.$invalid) return true;
                if ($scope.status('saveBtn', ['processing'])) return true;
                return false;
            }
        }).init();
    }
</script>