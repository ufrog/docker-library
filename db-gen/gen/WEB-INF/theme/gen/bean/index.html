<div class="row" ng-controller="beanCtrl">
    <div class="col-sm-3">
        <div class="list-group">
            <div class="list-group-item">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="按名称查询简单类型" ng-model="beanFilter">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-primary" ng-click="beanFunc.form()"><i class="fa fa-plus"></i></button>
                    </span>
                </div>
            </div>
            <a href="#" class="list-group-item" title="{{bean.fullName}}" ng-repeat="bean in beans|orderBy:['packageName','code']|filter:beanFilter" ng-class="{active: current.bean === bean}" ng-click="beanFunc.active(bean)" ng-bind="bean.shortName"></a>
        </div>
    </div>
    <div class="col-sm-9" ng-include="beanUrl"></div>
</div>

<script type="text/javascript">
    'use strict';
    function beanCtrl($scope, $http) {
        angular.extend($scope, {
            // 初始化
            init: function() {
                $scope.beanFunc.find();
            },

            // 对象方法集合
            beanFunc: {
                // 查询对象
                find: function() {
                    $http({
                        method: 'get',
                        url: '${app}/bean/find/' + $scope.current.project.id
                    }).success(function(data) {
                        $scope.beans = data;
                        if ($scope.beans.length === 0) {
                            $scope.beanFunc.form();
                        } else {
                            $scope.beanFunc.active($scope.beans[0]);
                        }
                    });
                },

                // 激活对象
                active: function(bean) {
                    $scope.beanUrl = '${app}/bean/detail?' + $scope.timestamp();
                    $scope.current.bean = bean;
                },

                // 初始化表单
                form: function() {
                    $scope.beanUrl = '${app}/bean/form?' + $scope.timestamp();
                }
            }
        }).init();
    }
</script>